(function(){
  function loadScript(url, callback){
  
    var script = document.createElement("script")
    script.type = "text/javascript";

    if (script.readyState){  //IE
        script.onreadystatechange = function(){
            if (script.readyState == "loaded" ||
                    script.readyState == "complete"){
                script.onreadystatechange = null;
                callback();
            }
        };
    } else {  //Others
        script.onload = function(){
            callback();
        };
    }

    script.src = url;
    document.getElementsByTagName("head")[0].appendChild(script);
  }
  function loadStyle(url){
    var link = document.createElement( "link" );
    link.href = url;
    link.type = "text/css";
    link.rel = "stylesheet";

    document.getElementsByTagName( "head" )[0].appendChild( link );
  }

  var myAppJavaScript = function($){
    var sliders = <% if(locals.sliders){%> <%- JSON.stringify(sliders) %> <% } else {%> undefined <%}%>;
    var handler = ".toptal-product-slider"
    loadStyle("//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css")
    loadScript("//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js", function(){
      $.fn.slick = window.jQuery.fn.slick;
      if(sliders.length){
        var $el = $(handler);
        var sliderId = $el.attr('data-slider-id');
        var slider = (sliderId) ? sliders.find(function(s){return s._id === sliderId}) : sliders[0]
        var str = ''
        slider.products.forEach(function(product){
          str += '<img src="' + product.data.image.src + '" />'
        })
        $el.append(str)
        $el.slick();
      }
    })
  };

  if ((typeof jQuery === 'undefined') || (parseFloat(jQuery.fn.jquery) < 1.7)) {
    console.log(jQuery.fn.jquery)
    loadScript("//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js", function(){
      jQuery191 = jQuery.noConflict(true);
      myAppJavaScript(jQuery191);
    });
  } else {
    myAppJavaScript(jQuery);
  }
})();